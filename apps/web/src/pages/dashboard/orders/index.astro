---
// apps/web/src/pages/dashboard/orders/index.astro
// Updated: COD support â€” payment method badge, payment status, action buttons
import DashboardLayout from '../../../layouts/DashboardLayout.astro';
import { getLocaleFromCookie, t } from '../../../i18n/index.js';

const cookies = Astro.request.headers.get('cookie') ?? '';
const locale = getLocaleFromCookie(cookies);
const API_URL = import.meta.env.PUBLIC_API_URL ?? 'http://localhost:8787';
---

<DashboardLayout title={t('orders.title', locale)} activeNav="orders">
  <div>

    <!-- Filters bar -->
    <div style="display:flex;gap:0.75rem;align-items:center;margin-bottom:1.25rem;flex-wrap:wrap">
      <select id="status-filter"
        style="border:1px solid #e2e8f0;border-radius:8px;padding:0.5rem 0.875rem;font-family:inherit;font-size:0.875rem;outline:none;background:#fff">
        <option value="">{locale === 'ar' ? 'ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª' : 'All Orders'}</option>
        <option value="pending">{t('orders.status.pending', locale)}</option>
        <option value="paid">{t('orders.status.paid', locale)}</option>
        <option value="shipped">{t('orders.status.shipped', locale)}</option>
        <option value="delivered">{t('orders.status.delivered', locale)}</option>
        <option value="cancelled">{t('orders.status.cancelled', locale)}</option>
        <option value="refunded">{t('orders.status.refunded', locale)}</option>
      </select>

      <select id="payment-filter"
        style="border:1px solid #e2e8f0;border-radius:8px;padding:0.5rem 0.875rem;font-family:inherit;font-size:0.875rem;outline:none;background:#fff">
        <option value="">{locale === 'ar' ? 'ÙƒÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹' : 'All Payment Methods'}</option>
        <option value="STRIPE">{t('orders.payment_method.STRIPE', locale)}</option>
        <option value="COD">{t('orders.payment_method.COD', locale)}</option>
      </select>

      <span id="total-count" style="font-size:0.875rem;color:#64748b;margin-inline-start:auto"></span>
    </div>

    <!-- COD pending alert -->
    <div id="cod-alert" style="display:none;background:#fffbeb;border:1px solid #fde68a;border-radius:10px;padding:0.875rem 1rem;margin-bottom:1rem;font-size:0.8rem;color:#92400e">
      <span id="cod-alert-text"></span>
    </div>

    <!-- Table -->
    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:12px;overflow:auto">
      <table style="width:100%;border-collapse:collapse;font-size:0.875rem;min-width:700px">
        <thead>
          <tr style="background:#f8fafc;border-bottom:1px solid #e2e8f0">
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569;white-space:nowrap">{t('orders.id', locale)}</th>
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569">{t('orders.customer', locale)}</th>
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569;white-space:nowrap">{t('orders.payment_method', locale)}</th>
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569;white-space:nowrap">{t('orders.total', locale)}</th>
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569">{t('orders.status', locale)}</th>
            <th style="text-align:start;padding:0.875rem 1rem;font-weight:600;color:#475569;white-space:nowrap">{t('orders.date', locale)}</th>
            <th style="padding:0.875rem 1rem"></th>
          </tr>
        </thead>
        <tbody id="orders-tbody">
          <tr><td colspan="7" style="text-align:center;padding:3rem;color:#94a3b8">
            {locale === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading...'}
          </td></tr>
        </tbody>
      </table>
    </div>

    <div id="pagination" style="display:flex;justify-content:center;gap:0.5rem;margin-top:1rem"></div>

    <!-- â”€â”€ Status Update Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="modal-overlay"
      style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:100;align-items:center;justify-content:center">
      <div style="background:#fff;border-radius:16px;padding:1.5rem;width:100%;max-width:440px;box-shadow:0 20px 60px rgba(0,0,0,0.2);margin:1rem">

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
          <h3 style="font-size:1rem;font-weight:600">
            {locale === 'ar' ? 'ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨' : 'Update Order Status'}
          </h3>
          <span id="modal-payment-badge"
            style="font-size:0.7rem;font-weight:700;padding:0.2rem 0.5rem;border-radius:100px"></span>
        </div>

        <input type="hidden" id="modal-order-id" />
        <input type="hidden" id="modal-payment-method" />

        <!-- Fulfillment status -->
        <div style="margin-bottom:0.875rem">
          <label style="display:block;font-size:0.8rem;font-weight:500;margin-bottom:0.375rem">
            {locale === 'ar' ? 'Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨' : 'Order Status'}
          </label>
          <select id="modal-status"
            style="width:100%;border:1.5px solid #e2e8f0;border-radius:8px;padding:0.625rem 0.875rem;font-family:inherit;font-size:0.875rem;outline:none;background:#fff">
            <option value="pending">{t('orders.status.pending', locale)}</option>
            <option value="paid">{t('orders.status.paid', locale)}</option>
            <option value="shipped">{t('orders.status.shipped', locale)}</option>
            <option value="delivered">{t('orders.status.delivered', locale)}</option>
            <option value="cancelled">{t('orders.status.cancelled', locale)}</option>
            <option value="refunded">{t('orders.status.refunded', locale)}</option>
          </select>
        </div>

        <!-- Payment status (COD only â€” shown conditionally) -->
        <div id="modal-payment-status-group" style="display:none;margin-bottom:0.875rem">
          <label style="display:block;font-size:0.8rem;font-weight:500;margin-bottom:0.375rem">
            {locale === 'ar' ? 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹' : 'Payment Status'}
          </label>
          <select id="modal-payment-status"
            style="width:100%;border:1.5px solid #e2e8f0;border-radius:8px;padding:0.625rem 0.875rem;font-family:inherit;font-size:0.875rem;outline:none;background:#fff">
            <option value="UNPAID">{t('orders.payment_status.UNPAID', locale)}</option>
            <option value="PAID">{t('orders.payment_status.PAID', locale)}</option>
            <option value="PENDING">{t('orders.payment_status.PENDING', locale)}</option>
            <option value="FAILED">{t('orders.payment_status.FAILED', locale)}</option>
          </select>
        </div>

        <!-- Note -->
        <div style="margin-bottom:1rem">
          <label style="display:block;font-size:0.8rem;font-weight:500;margin-bottom:0.375rem">
            {locale === 'ar' ? 'Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)' : 'Note (optional)'}
          </label>
          <input id="modal-note" type="text" maxlength="500"
            style="width:100%;border:1.5px solid #e2e8f0;border-radius:8px;padding:0.625rem 0.875rem;font-family:inherit;font-size:0.875rem;outline:none;box-sizing:border-box" />
        </div>

        <!-- COD quick-action buttons -->
        <div id="modal-cod-actions" style="display:none;margin-bottom:1rem">
          <p style="font-size:0.75rem;font-weight:600;color:#64748b;margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.05em">
            {locale === 'ar' ? 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©' : 'Quick Actions'}
          </p>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
            <button onclick="setQuickStatus('shipped')"
              style="flex:1;padding:0.5rem;border:1px solid #bfdbfe;border-radius:8px;background:#eff6ff;color:#1d4ed8;font-family:inherit;font-size:0.8rem;cursor:pointer;font-weight:600">
              ğŸšš {t('orders.action.ship', locale)}
            </button>
            <button onclick="setQuickStatus('delivered')"
              style="flex:1;padding:0.5rem;border:1px solid #bbf7d0;border-radius:8px;background:#f0fdf4;color:#166534;font-family:inherit;font-size:0.8rem;cursor:pointer;font-weight:600">
              âœ… {t('orders.action.deliver', locale)}
            </button>
            <button onclick="setQuickStatus('cancelled')"
              style="flex:1;padding:0.5rem;border:1px solid #fecaca;border-radius:8px;background:#fef2f2;color:#991b1b;font-family:inherit;font-size:0.8rem;cursor:pointer;font-weight:600">
              âœ• {t('orders.action.cancel', locale)}
            </button>
          </div>
        </div>

        <div id="modal-error" style="display:none;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:0.5rem 0.75rem;border-radius:8px;font-size:0.8rem;margin-bottom:0.875rem"></div>

        <div style="display:flex;gap:0.75rem;justify-content:flex-end">
          <button onclick="closeModal()"
            style="padding:0.5rem 1rem;border:1px solid #e2e8f0;border-radius:8px;background:none;cursor:pointer;font-family:inherit;font-size:0.875rem">
            {locale === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel'}
          </button>
          <button onclick="saveStatus()"
            style="padding:0.5rem 1.25rem;background:#6366f1;color:#fff;border:none;border-radius:8px;font-family:inherit;font-weight:600;cursor:pointer;font-size:0.875rem">
            {locale === 'ar' ? 'Ø­ÙØ¸' : 'Save'}
          </button>
        </div>
      </div>
    </div>

  </div>
</DashboardLayout>

<script define:vars={{ API_URL, locale }}>
  const tenantSlug = localStorage.getItem('tenant_slug') ?? '';
  let currentPage = 1;

  // â”€â”€ i18n maps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const statusLabel = {
    pending:   locale === 'ar' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 'Pending',
    paid:      locale === 'ar' ? 'Ù…Ø¯ÙÙˆØ¹'        : 'Paid',
    shipped:   locale === 'ar' ? 'ØªÙ… Ø§Ù„Ø´Ø­Ù†'     : 'Shipped',
    delivered: locale === 'ar' ? 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„'   : 'Delivered',
    cancelled: locale === 'ar' ? 'Ù…Ù„ØºÙŠ'          : 'Cancelled',
    refunded:  locale === 'ar' ? 'Ù…Ø³ØªØ±Ø¬Ø¹'        : 'Refunded',
  };
  const statusStyle = {
    pending:   'background:#fef3c7;color:#92400e',
    paid:      'background:#d1fae5;color:#065f46',
    shipped:   'background:#dbeafe;color:#1e40af',
    delivered: 'background:#dcfce7;color:#166534',
    cancelled: 'background:#fee2e2;color:#991b1b',
    refunded:  'background:#f3e8ff;color:#7c3aed',
  };
  const paymentMethodLabel = {
    STRIPE: locale === 'ar' ? 'ğŸ’³ Ø¨Ø·Ø§Ù‚Ø©'       : 'ğŸ’³ Card',
    COD:    locale === 'ar' ? 'ğŸ  Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…' : 'ğŸ  COD',
  };
  const paymentStatusLabel = {
    PAID:    locale === 'ar' ? 'Ù…Ø¯ÙÙˆØ¹'       : 'Paid',
    UNPAID:  locale === 'ar' ? 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹'   : 'Unpaid',
    PENDING: locale === 'ar' ? 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 'Pending',
    FAILED:  locale === 'ar' ? 'ÙØ´Ù„'         : 'Failed',
  };
  const paymentStatusStyle = {
    PAID:    'color:#065f46',
    UNPAID:  'color:#92400e;font-weight:700',
    PENDING: 'color:#6b7280',
    FAILED:  'color:#991b1b',
  };

  // â”€â”€ Load orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadOrders(page = 1) {
    currentPage = page;
    const status = document.getElementById('status-filter').value;
    const paymentMethod = document.getElementById('payment-filter').value;

    const params = new URLSearchParams({ page, limit: 20 });
    if (status) params.set('status', status);
    if (paymentMethod) params.set('paymentMethod', paymentMethod);

    const tbody = document.getElementById('orders-tbody');
    tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:2rem;color:#94a3b8">${locale === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading...'}</td></tr>`;

    try {
      const res = await fetch(`${API_URL}/dashboard/orders?${params}`, {
        credentials: 'include',
        headers: { 'X-Tenant-Slug': tenantSlug },
      });

      if (res.status === 401) {
        window.location.href = '/auth/login';
        return;
      }

      const data = await res.json();
      const orders = data.data ?? [];
      const total = data.total ?? orders.length;

      document.getElementById('total-count').textContent =
        total > 0 ? `${total} ${locale === 'ar' ? 'Ø·Ù„Ø¨' : 'orders'}` : '';

      // COD pending alert
      const codPending = orders.filter(o => o.paymentMethod === 'COD' && o.status === 'pending');
      const codAlert = document.getElementById('cod-alert');
      if (codPending.length > 0 && !paymentMethod && !status) {
        const alertText = locale === 'ar'
          ? `âš ï¸ Ù„Ø¯ÙŠÙƒ ${codPending.length} Ø·Ù„Ø¨(Ø§Øª) COD ØªÙ†ØªØ¸Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯`
          : `âš ï¸ You have ${codPending.length} COD order(s) awaiting confirmation`;
        document.getElementById('cod-alert-text').textContent = alertText;
        codAlert.style.display = 'block';
      } else {
        codAlert.style.display = 'none';
      }

      if (!orders.length) {
        tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:3rem;color:#94a3b8">
          <div style="font-size:2rem;margin-bottom:0.5rem">ğŸ›’</div>
          <p>${locale === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª' : 'No orders found'}</p>
        </td></tr>`;
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      tbody.innerHTML = orders.map(o => {
        const date = new Date(o.createdAt).toLocaleDateString(
          locale === 'ar' ? 'ar-MA' : 'en-GB',
          { year: 'numeric', month: 'short', day: 'numeric' }
        );
        const isCod = o.paymentMethod === 'COD';
        const isUrgent = isCod && o.status === 'pending';

        return `
          <tr style="border-bottom:1px solid #f1f5f9;${isUrgent ? 'background:#fffbeb' : ''}"
            onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='${isUrgent ? '#fffbeb' : ''}'">

            <td style="padding:0.875rem 1rem;font-weight:600;font-family:monospace;white-space:nowrap">
              #${o.id.slice(-6).toUpperCase()}
              ${isUrgent ? '<span style="display:inline-block;width:6px;height:6px;background:#f59e0b;border-radius:50%;margin-inline-start:4px;vertical-align:middle"></span>' : ''}
            </td>

            <td style="padding:0.875rem 1rem;max-width:200px">
              <div style="color:#334155;font-size:0.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${o.customerEmail}</div>
              ${o.customerPhone ? `<div style="color:#94a3b8;font-size:0.75rem">${o.customerPhone}</div>` : ''}
            </td>

            <td style="padding:0.875rem 1rem;white-space:nowrap">
              <span style="font-size:0.8rem;font-weight:600;${isCod ? 'color:#92400e' : 'color:#374151'}">
                ${paymentMethodLabel[o.paymentMethod] ?? o.paymentMethod}
              </span>
              <div style="font-size:0.7rem;margin-top:0.1rem;${paymentStatusStyle[o.paymentStatus] ?? ''}">
                ${paymentStatusLabel[o.paymentStatus] ?? o.paymentStatus}
              </div>
            </td>

            <td style="padding:0.875rem 1rem;font-weight:600;white-space:nowrap">${o.total.toFixed(2)} ${o.currency}</td>

            <td style="padding:0.875rem 1rem">
              <span style="display:inline-block;padding:0.2rem 0.625rem;border-radius:100px;font-size:0.75rem;font-weight:600;${statusStyle[o.status] ?? ''}">
                ${statusLabel[o.status] ?? o.status}
              </span>
            </td>

            <td style="padding:0.875rem 1rem;color:#64748b;font-size:0.8rem;white-space:nowrap">${date}</td>

            <td style="padding:0.875rem 1rem;white-space:nowrap">
              <button onclick="openModal('${o.id}', '${o.status}', '${o.paymentMethod}', '${o.paymentStatus}')"
                style="font-size:0.8rem;color:#6366f1;border:1px solid #e0e7ff;padding:0.3rem 0.75rem;border-radius:6px;background:#f5f3ff;cursor:pointer;font-family:inherit;font-weight:600">
                ${locale === 'ar' ? 'ØªØ­Ø¯ÙŠØ«' : 'Update'}
              </button>
            </td>
          </tr>
        `;
      }).join('');

      // Pagination
      if (data.total > 20) {
        const totalPages = Math.ceil(data.total / 20);
        document.getElementById('pagination').innerHTML = Array.from({ length: totalPages }, (_, i) => i + 1)
          .map(p => `
            <button onclick="loadOrders(${p})"
              style="width:32px;height:32px;border-radius:8px;border:1px solid ${p === currentPage ? '#6366f1' : '#e2e8f0'};
              background:${p === currentPage ? '#6366f1' : '#fff'};color:${p === currentPage ? '#fff' : '#374151'};
              cursor:pointer;font-family:inherit;font-size:0.875rem">${p}</button>
          `).join('');
      } else {
        document.getElementById('pagination').innerHTML = '';
      }

    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;padding:2rem;color:#ef4444">
        ${locale === 'ar' ? 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª' : 'Failed to load orders'}
      </td></tr>`;
    }
  }

  // â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(orderId, currentStatus, paymentMethod, currentPaymentStatus) {
    document.getElementById('modal-order-id').value = orderId;
    document.getElementById('modal-payment-method').value = paymentMethod;
    document.getElementById('modal-status').value = currentStatus;
    document.getElementById('modal-note').value = '';
    document.getElementById('modal-error').style.display = 'none';

    // Payment badge
    const badge = document.getElementById('modal-payment-badge');
    if (paymentMethod === 'COD') {
      badge.textContent = 'COD';
      badge.style.cssText = 'background:#fef3c7;color:#92400e;font-size:0.7rem;font-weight:700;padding:0.2rem 0.5rem;border-radius:100px';
    } else {
      badge.textContent = 'STRIPE';
      badge.style.cssText = 'background:#f0f9ff;color:#0369a1;font-size:0.7rem;font-weight:700;padding:0.2rem 0.5rem;border-radius:100px';
    }

    // Show COD-specific controls
    const isCod = paymentMethod === 'COD';
    document.getElementById('modal-payment-status-group').style.display = isCod ? 'block' : 'none';
    document.getElementById('modal-cod-actions').style.display = isCod ? 'block' : 'none';
    if (isCod) {
      document.getElementById('modal-payment-status').value = currentPaymentStatus;
    }

    document.getElementById('modal-overlay').style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('modal-overlay').style.display = 'none';
  }

  function setQuickStatus(status) {
    document.getElementById('modal-status').value = status;
    // Auto-set payment status for COD quick actions
    if (status === 'delivered') {
      document.getElementById('modal-payment-status').value = 'PAID';
    } else if (status === 'cancelled') {
      document.getElementById('modal-payment-status').value = 'UNPAID';
    }
  }

  async function saveStatus() {
    const orderId = document.getElementById('modal-order-id').value;
    const paymentMethod = document.getElementById('modal-payment-method').value;
    const status = document.getElementById('modal-status').value;
    const note = document.getElementById('modal-note').value.trim();
    const errorEl = document.getElementById('modal-error');

    // Confirm cancel
    if (status === 'cancelled') {
      const msg = locale === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ' : 'Are you sure you want to cancel this order?';
      if (!confirm(msg)) return;
    }

    const body = { status, note: note || undefined };
    if (paymentMethod === 'COD') {
      body.paymentStatus = document.getElementById('modal-payment-status').value;
    }

    errorEl.style.display = 'none';

    const res = await fetch(`${API_URL}/dashboard/orders/${orderId}/status`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json', 'X-Tenant-Slug': tenantSlug },
      credentials: 'include',
      body: JSON.stringify(body),
    });

    if (res.ok) {
      closeModal();
      loadOrders(currentPage);
    } else {
      const data = await res.json().catch(() => ({}));
      errorEl.textContent = data.error ?? (locale === 'ar' ? 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«' : 'Update failed');
      errorEl.style.display = 'block';
    }
  }

  // â”€â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('modal-overlay').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) closeModal();
  });

  document.getElementById('status-filter').addEventListener('change', () => loadOrders(1));
  document.getElementById('payment-filter').addEventListener('change', () => loadOrders(1));

  // Expose to HTML onclick handlers
  window.openModal = openModal;
  window.closeModal = closeModal;
  window.saveStatus = saveStatus;
  window.setQuickStatus = setQuickStatus;
  window.loadOrders = loadOrders;

  loadOrders();
</script>
